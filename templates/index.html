<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CT Viewer with Label Overlay</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
      }
      #controls {
        margin-bottom: 20px;
      }
      #viewer {
        position: relative;
        display: inline-block;
        border: 1px solid #ccc;
      }
      #ctCanvas {
        display: block; 
      }
      #maskCanvas {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0.47;
      }
      input[type="number"] {
        width: 100px;
      }
    </style>
  </head>
  <body>
    <h1>CT Slice Viewer</h1>

    <p>
      Number of slices: <strong>{{ num_slices }}</strong><br />
      Valid indices: <strong>0</strong> to <strong>{{ num_slices - 1 }}</strong>
    </p>

    <div id="controls">
      <label for="sliceInput">Slice index:</label>
      <input
        id="sliceInput"
        type="number"
        min="0"
        max="{{ num_slices - 1 }}"
        value="{{ (num_slices - 1) // 2 }}"
      />
      <span id="sliceError" style="color: red; margin-left: 10px;"></span>

      <br /><br />

      <label for="labelSelect">Mask label:</label>
      <select id="labelSelect">
        <option value="">(None)</option>
        {% for lbl in labels %}
        <option
          value="{{ lbl.id }}"
          data-color="{{ lbl.color_rgb[0] }},{{ lbl.color_rgb[1] }},{{ lbl.color_rgb[2] }}"
        >
          {{ lbl.name }}
        </option>
        {% endfor %}
      </select>

      <br /><br />

        <button id="penBtn" type="button">Pen</button>
        <button id="rubberBtn" type="button">Rubber</button>

        <button id="lassoPenBtn" type="button" style="margin-left: 10px;">Lasso Pen</button>
        <button id="lassoRubberBtn" type="button">Lasso Rubber</button>

        <span id="modeIndicator" style="margin-left: 10px; font-style: italic;"></span>
        
        <br /><br />
        
        <button id="saveBtn" type="button">Save</button>

        <button id="undoBtn" type="button" style="margin-left: 10px;">Undo</button>
        <button id="redoBtn" type="button">Redo</button>

        <span id="saveStatus" style="margin-left: 10px;"></span>

      <br /><br />

      <label for="zoomInput">Zoom:</label>
      <input id="zoomInput" type="number" value="0" step="0.1" />
      <span style="font-size: 0.9em; color: #666;">0 = 1x</span>

      <br /><br />

      <label for="panXInput">Pan X:</label>
      <input id="panXInput" type="number" value="0" step="1" />

      <label for="panYInput" style="margin-left: 10px;">Pan Y:</label>
      <input id="panYInput" type="number" value="0" step="1" />
    </div>

    <div id="viewer">
      <!-- background CT slice -->
      <canvas id="ctCanvas"></canvas>
      <!-- overlay mask slice, now as canvas -->
      <canvas id="maskCanvas"></canvas>
    </div>
        
    <!-- inject numSlices into a global so external JS can use it -->
    <script src="{{ url_for('static', filename='js/mask_editor.js') }}"></script>
    <script>
      window.numSlices = {{ num_slices }};
    </script>
    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>
  </body>
</html>
