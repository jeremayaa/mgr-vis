<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CT Viewer with Label Overlay</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
      }
      #controls {
        margin-bottom: 20px;
      }
      #viewer {
        position: relative;
        display: inline-block;
        border: 1px solid #ccc;
      }
      #ctImg {
        display: block; /* defines container size */
      }
      #maskCanvas {
        position: absolute;
        top: 0;
        left: 0;
        /* keep pointer-events enabled for future drawing;
          can be pointer-events: none */
      }
      input[type="number"] {
        width: 100px;
      }
    </style>
  </head>
  <body>
    <h1>CT Slice Viewer</h1>

    <p>
      Number of slices: <strong>{{ num_slices }}</strong><br />
      Valid indices: <strong>0</strong> to <strong>{{ num_slices - 1 }}</strong>
    </p>

    <div id="controls">
      <label for="sliceInput">Slice index:</label>
      <input
        id="sliceInput"
        type="number"
        min="0"
        max="{{ num_slices - 1 }}"
        value="{{ (num_slices - 1) // 2 }}"
      />
      <span id="sliceError" style="color: red; margin-left: 10px;"></span>

      <br /><br />

      <label for="labelSelect">Mask label:</label>
      <select id="labelSelect">
        <option value="">(None)</option>
        {% for lbl in labels %}
        <option value="{{ lbl.id }}">{{ lbl.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div id="viewer">
      <!-- background CT slice -->
      <img id="ctImg" src="" alt="CT slice" />
      <!-- overlay mask slice, now as canvas -->
      <canvas id="maskCanvas"></canvas>
    </div>
        
    <!-- inject numSlices into a global so external JS can use it -->
    <script>
      window.numSlices = {{ num_slices }};
    </script>
    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>

  </body>
</html>
